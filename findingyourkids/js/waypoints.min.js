(function(n,t,i,r){var s=n(r),f="waypoint.reached",e=function(n,i){n.element.trigger(f,i);n.options.triggerOnce&&n.element[t]("destroy")},c=function(n,t){if(!t)return-1;for(var i=t.waypoints.length-1;i>=0&&t.waypoints[i].element[0]!==n[0];)i-=1;return i},u=[],l=function(t){n.extend(this,{element:n(t),oldScroll:0,waypoints:[],didScroll:!1,didResize:!1,doScroll:n.proxy(function(){var t=this.element.scrollTop(),r=t>this.oldScroll,f=this,u=n.grep(this.waypoints,function(n){return r?n.offset>f.oldScroll&&n.offset<=t:n.offset<=f.oldScroll&&n.offset>t}),o=u.length;(this.oldScroll&&t||n[i]("refresh"),this.oldScroll=t,o)&&(r||u.reverse(),n.each(u,function(n,t){(t.options.continuous||n===o-1)&&e(t,[r?"down":"up"])}))},this)});n(t).bind("scroll.waypoints",n.proxy(function(){this.didScroll||(this.didScroll=!0,r.setTimeout(n.proxy(function(){this.doScroll();this.didScroll=!1},this),n[i].settings.scrollThrottle))},this)).bind("resize.waypoints",n.proxy(function(){this.didResize||(this.didResize=!0,r.setTimeout(n.proxy(function(){n[i]("refresh");this.didResize=!1},this),n[i].settings.resizeThrottle))},this));s.load(n.proxy(function(){this.doScroll()},this))},a=function(t){var i=null;return n.each(u,function(n,r){if(r.element[0]===t)return i=r,!1}),i},o={init:function(r,e){return this.each(function(){var o=n.fn[t].defaults.context,s,h=n(this);e&&e.context&&(o=e.context);n.isWindow(o)||(o=h.closest(o)[0]);s=a(o);s||(s=new l(o),u.push(s));var y=c(h,s),p=y<0?n.fn[t].defaults:s.waypoints[y].options,v=n.extend({},p,e);v.offset=v.offset==="bottom-in-view"?function(){var t=n.isWindow(o)?n[i]("viewportHeight"):n(o).height();return t-n(this).outerHeight()}:v.offset;y<0?s.waypoints.push({element:h,offset:null,options:v}):s.waypoints[y].options=v;r&&h.bind(f,r);e&&e.handler&&h.bind(f,e.handler)}),n[i]("refresh"),this},remove:function(){return this.each(function(t,i){var r=n(i);n.each(u,function(n,t){var i=c(r,t);i>=0&&(t.waypoints.splice(i,1),t.waypoints.length||(t.element.unbind("scroll.waypoints resize.waypoints"),u.splice(n,1)))})})},destroy:function(){return this.unbind(f)[t]("remove")}},h={refresh:function(){n.each(u,function(t,r){var u=n.isWindow(r.element[0]),f=u?0:r.element.offset().top,o=u?n[i]("viewportHeight"):r.element.height(),s=u?0:r.element.scrollTop();n.each(r.waypoints,function(n,t){var u,i,h;t&&((u=t.options.offset,i=t.offset,typeof t.options.offset=="function"?u=t.options.offset.apply(t.element):typeof t.options.offset=="string"&&(h=parseFloat(t.options.offset),u=t.options.offset.indexOf("%")?Math.ceil(o*(h/100)):h),t.offset=t.element.offset().top-f+s-u,t.options.onlyOnScroll)||(i!==null&&r.oldScroll>i&&r.oldScroll<=t.offset?e(t,["up"]):i!==null&&r.oldScroll<i&&r.oldScroll>=t.offset?e(t,["down"]):!i&&r.element.scrollTop()>t.offset&&e(t,["down"])))});r.waypoints.sort(function(n,t){return n.offset-t.offset})})},viewportHeight:function(){return r.innerHeight?r.innerHeight:s.height()},aggregate:function(){var t=n();return n.each(u,function(i,r){n.each(r.waypoints,function(n,i){t=t.add(i.element)})}),t}};n.fn[t]=function(i){if(o[i])return o[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="function"&&i){if(typeof i=="object")return o.init.apply(this,[null,i]);n.error("Method "+i+" does not exist on jQuery "+t)}else return o.init.apply(this,arguments)};n.fn[t].defaults={continuous:!0,offset:0,triggerOnce:!1,context:r};n[i]=function(n){return h[n]?h[n].apply(this):h.aggregate()};n[i].settings={resizeThrottle:200,scrollThrottle:100};s.load(function(){n[i]("refresh")})})(jQuery,"waypoint","waypoints",window);
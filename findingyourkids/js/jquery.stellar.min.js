(function(n,t,i,r){function o(t,i){this.element=t;this.options=n.extend({},c,i);this._defaults=c;this._name=u;this.init()}var u="stellar",c={scrollProperty:"scroll",positionProperty:"position",horizontalScrolling:!0,verticalScrolling:!0,horizontalOffset:0,verticalOffset:0,parallaxBackgrounds:!0,parallaxElements:!0,hideDistantElements:!0,viewportDetectionInterval:1e4,hideElement:function(n){n.hide()},showElement:function(n){n.show()}},e={scroll:{getTop:function(n){return n.scrollTop()},setTop:function(n,t){n.scrollTop(t)},getLeft:function(n){return n.scrollLeft()},setLeft:function(n,t){n.scrollLeft(t)}},position:{getTop:function(n){return parseInt(n.css("top"),10)*-1},setTop:function(n,t){n.css("top",t)},getLeft:function(n){return parseInt(n.css("left"),10)*-1},setLeft:function(n,t){n.css("left",t)}},margin:{getTop:function(n){return parseInt(n.css("margin-top"),10)*-1},setTop:function(n,t){n.css("margin-top",t)},getLeft:function(n){return parseInt(n.css("margin-left"),10)*-1},setLeft:function(n,t){n.css("margin-left",t)}},transform:{getTop:function(n){return n.css(f+"transform")!=="none"?parseInt(n.css(f+"transform").match(/(-?[0-9]+)/g)[5],10)*-1:0},setTop:function(n,t){s(n,t,"Y")},getLeft:function(n){return n.css(f+"transform")!=="none"?parseInt(n.css(f+"transform").match(/(-?[0-9]+)/g)[4],10)*-1:0},setLeft:function(n,t){s(n,t,"X")}}},h={position:{setTop:function(n,t){n.css("top",t)},setLeft:function(n,t){n.css("left",t)}},transform:{setTop:function(n,t,i){s(n,t-i,"Y")},setLeft:function(n,t,i){s(n,t-i,"X")}}},f=function(){var t="";return n.browser.webkit?t="-webkit-":n.browser.mozilla?t="-moz-":n.browser.opera?t="-o-":n.browser.msie&&(t="-ms-"),t}(),s=function(n,t,i){var r=n.css(f+"transform");r==="none"?n.css(f+"transform","translate"+i+"("+t+"px)"):n.css(f+"transform",l(r,/(-?[0-9]+[.]?[0-9]*)/g,i==="X"?5:6,t))},l=function(n,t,i,u){var f,e;return n.search(t)===-1?n:(f=n.split(t),e=i*2-1,f[e]===r?n:(f[e]=u,f.join("")))};o.prototype={init:function(){this.options.name=u+"_"+Math.floor(Math.random()*1e4);this._defineElements();this._defineGetters();this._defineSetters();this.refresh();this._startViewportDetectionLoop();this._startAnimationLoop()},_defineElements:function(){this.element===i.body&&(this.element=t);this.$scrollElement=n(this.element);this.$element=this.element===t?n("body"):this.$scrollElement;this.$viewportElement=this.options.viewportElement!==r?n(this.options.viewportElement):this.$scrollElement[0]===t||this.options.scrollProperty.indexOf("scroll")===0?this.$scrollElement:this.$scrollElement.parent()},_defineGetters:function(){var n=this;this._getScrollLeft=function(){return e[n.options.scrollProperty].getLeft(n.$scrollElement)};this._getScrollTop=function(){return e[n.options.scrollProperty].getTop(n.$scrollElement)}},_defineSetters:function(){var n=this;this._setScrollLeft=function(t){e[n.options.scrollProperty].setLeft(n.$scrollElement,t)};this._setScrollTop=function(t){e[n.options.scrollProperty].setTop(n.$scrollElement,t)};this._setLeft=function(t,i,r){h[n.options.positionProperty].setLeft(t,i,r)};this._setTop=function(t,i,r){h[n.options.positionProperty].setTop(t,i,r)}},refresh:function(){var i=this,r=i._getScrollLeft(),u=i._getScrollTop();this._setScrollLeft(0);this._setScrollTop(0);this._setOffsets();this._findParticles();this._findBackgrounds();navigator.userAgent.indexOf("WebKit")>0&&n(t).load(function(){var n=i._getScrollLeft(),t=i._getScrollTop();i._setScrollLeft(n+1);i._setScrollTop(t+1);i._setScrollLeft(n);i._setScrollTop(t)});i._setScrollLeft(r);i._setScrollTop(u)},_findParticles:function(){var t=this,u=this._getScrollLeft(),f=this._getScrollTop(),i;if(this.particles!==r)for(i=this.particles.length-1;i>=0;i--)this.particles[i].$element.data("stellar-elementIsActive",r);(this.particles=[],this.options.parallaxElements)&&this.$element.find("[data-stellar-ratio]").each(function(){var i=n(this),f,e,o,s,h,c,u,l,a,v=0,y=0,p=0,w=0;if(i.data("stellar-elementIsActive")){if(i.data("stellar-elementIsActive")!==this)return}else i.data("stellar-elementIsActive",this);t.options.showElement(i);i.data("stellar-startingLeft")?(i.css("left",i.data("stellar-startingLeft")),i.css("top",i.data("stellar-startingTop"))):(i.data("stellar-startingLeft",i.css("left")),i.data("stellar-startingTop",i.css("top")));o=i.position().left;s=i.position().top;h=i.css("margin-left")==="auto"?0:parseInt(i.css("margin-left"),10);c=i.css("margin-top")==="auto"?0:parseInt(i.css("margin-top"),10);l=i.offset().left-h;a=i.offset().top-c;i.parents().each(function(){var t=n(this);if(t.data("stellar-offset-parent")===!0)return v=p,y=w,u=t,!1;p+=t.position().left;w+=t.position().top});f=i.data("stellar-horizontal-offset")!==r?i.data("stellar-horizontal-offset"):u!==r&&u.data("stellar-horizontal-offset")!==r?u.data("stellar-horizontal-offset"):t.horizontalOffset;e=i.data("stellar-vertical-offset")!==r?i.data("stellar-vertical-offset"):u!==r&&u.data("stellar-vertical-offset")!==r?u.data("stellar-vertical-offset"):t.verticalOffset;t.particles.push({$element:i,$offsetParent:u,isFixed:i.css("position")==="fixed",horizontalOffset:f,verticalOffset:e,startingPositionLeft:o,startingPositionTop:s,startingOffsetLeft:l,startingOffsetTop:a,parentOffsetLeft:v,parentOffsetTop:y,stellarRatio:i.data("stellar-ratio")!==r?i.data("stellar-ratio"):1,width:i.outerWidth(!0),height:i.outerHeight(!0),isHidden:!1})})},_findBackgrounds:function(){var t=this,u=this._getScrollLeft(),f=this._getScrollTop(),i;(this.backgrounds=[],this.options.parallaxBackgrounds)&&(i=this.$element.find("[data-stellar-background-ratio]"),this.$element.is("[data-stellar-background-ratio]")&&i.add(this.$element),i.each(function(){var i=n(this),e=i.css("background-position").split(" "),s,h,c,l,a,v,o,y=0,p=0,w=0,b=0;if(i.data("stellar-backgroundIsActive")){if(i.data("stellar-backgroundIsActive")!==this)return}else i.data("stellar-backgroundIsActive",this);i.data("stellar-backgroundStartingLeft")?i.css("background-position",i.data("stellar-backgroundStartingLeft")+" "+i.data("stellar-backgroundStartingTop")):(i.data("stellar-backgroundStartingLeft",e[0]),i.data("stellar-backgroundStartingTop",e[1]));c=i.css("margin-left")==="auto"?0:parseInt(i.css("margin-left"),10);l=i.css("margin-top")==="auto"?0:parseInt(i.css("margin-top"),10);a=i.offset().left-c-u;v=i.offset().top-l-f;i.parents().each(function(){var t=n(this);if(t.data("stellar-offset-parent")===!0)return y=w,p=b,o=t,!1;w+=t.position().left;b+=t.position().top});s=i.data("stellar-horizontal-offset")!==r?i.data("stellar-horizontal-offset"):o!==r&&o.data("stellar-horizontal-offset")!==r?o.data("stellar-horizontal-offset"):t.horizontalOffset;h=i.data("stellar-vertical-offset")!==r?i.data("stellar-vertical-offset"):o!==r&&o.data("stellar-vertical-offset")!==r?o.data("stellar-vertical-offset"):t.verticalOffset;t.backgrounds.push({$element:i,$offsetParent:o,isFixed:i.css("background-attachment")==="fixed",horizontalOffset:s,verticalOffset:h,startingValueLeft:e[0],startingValueTop:e[1],startingBackgroundPositionLeft:isNaN(parseInt(e[0],10))?0:parseInt(e[0],10),startingBackgroundPositionTop:isNaN(parseInt(e[1],10))?0:parseInt(e[1],10),startingPositionLeft:i.position().left,startingPositionTop:i.position().top,startingOffsetLeft:a,startingOffsetTop:v,parentOffsetLeft:y,parentOffsetTop:p,stellarRatio:i.data("stellar-background-ratio")===r?1:i.data("stellar-background-ratio")})}))},destroy:function(){for(var i,u,f,r,t=this.particles.length-1;t>=0;t--)i=this.particles[t],u=i.$element.data("stellar-startingLeft"),f=i.$element.data("stellar-startingTop"),this._setLeft(i.$element,u,u),this._setTop(i.$element,f,f),this.options.showElement(i.$element),i.$element.data("stellar-startingLeft",null).data("stellar-elementIsActive",null).data("stellar-backgroundIsActive",null);for(t=this.backgrounds.length-1;t>=0;t--)r=this.backgrounds[t],r.$element.css("background-position",r.startingValueLeft+" "+r.startingValueTop);this._animationLoop=n.noop;clearInterval(this._viewportDetectionInterval)},_setOffsets:function(){var i=this;n(t).unbind("resize.horizontal-"+this.name).unbind("resize.vertical-"+this.name);typeof this.options.horizontalOffset=="function"?(this.horizontalOffset=this.options.horizontalOffset(),n(t).bind("resize.horizontal-"+this.name,function(){i.horizontalOffset=i.options.horizontalOffset()})):this.horizontalOffset=this.options.horizontalOffset;typeof this.options.verticalOffset=="function"?(this.verticalOffset=this.options.verticalOffset(),n(t).bind("resize.vertical-"+this.name,function(){i.verticalOffset=i.options.verticalOffset()})):this.verticalOffset=this.options.verticalOffset},_repositionElements:function(){var r=this._getScrollLeft(),u=this._getScrollTop(),n,f,t,c,l,a=!0,v=!0,e,o,s,h,i;if(this.currentScrollLeft!==r||this.currentScrollTop!==u||this.currentWidth!==this.viewportWidth||this.currentHeight!==this.viewportHeight){for(this.currentScrollLeft=r,this.currentScrollTop=u,this.currentWidth=this.viewportWidth,this.currentHeight=this.viewportHeight,i=this.particles.length-1;i>=0;i--)n=this.particles[i],f=n.isFixed?1:0,this.options.horizontalScrolling&&(e=(r+n.horizontalOffset+this.viewportOffsetLeft+n.startingPositionLeft-n.startingOffsetLeft+n.parentOffsetLeft)*-(n.stellarRatio+f-1)+n.startingPositionLeft,s=e-n.startingPositionLeft+n.startingOffsetLeft),this.options.verticalScrolling&&(o=(u+n.verticalOffset+this.viewportOffsetTop+n.startingPositionTop-n.startingOffsetTop+n.parentOffsetTop)*-(n.stellarRatio+f-1)+n.startingPositionTop,h=o-n.startingPositionTop+n.startingOffsetTop),this.options.hideDistantElements&&(v=!this.options.horizontalScrolling||s+n.width>(n.isFixed?0:r)&&s<(n.isFixed?0:r)+this.viewportWidth+this.viewportOffsetLeft,a=!this.options.verticalScrolling||h+n.height>(n.isFixed?0:u)&&h<(n.isFixed?0:u)+this.viewportHeight+this.viewportOffsetTop),v&&a?(n.isHidden&&(this.options.showElement(n.$element),n.isHidden=!1),this.options.horizontalScrolling&&this._setLeft(n.$element,e,n.startingPositionLeft),this.options.verticalScrolling&&this._setTop(n.$element,o,n.startingPositionTop)):n.isHidden||(this.options.hideElement(n.$element),n.isHidden=!0);for(i=this.backgrounds.length-1;i>=0;i--)t=this.backgrounds[i],f=t.isFixed?0:1,c=this.options.horizontalScrolling?(r+t.horizontalOffset-this.viewportOffsetLeft-t.startingOffsetLeft+t.parentOffsetLeft-t.startingBackgroundPositionLeft)*(f-t.stellarRatio)+"%":t.startingValueLeft,l=this.options.verticalScrolling?(u+t.verticalOffset-this.viewportOffsetTop-t.startingOffsetTop+t.parentOffsetTop-t.startingBackgroundPositionTop)*(f-t.stellarRatio)+"px":t.startingValueTop,t.$element.css("background-position",c+" "+l)}},_startViewportDetectionLoop:function(){var n=this,t=function(){var t=n.$viewportElement.offset();n.viewportWidth=n.$viewportElement.width();n.viewportHeight=n.$viewportElement.height();n.viewportOffsetTop=t!==null?t.top:0;n.viewportOffsetLeft=t!==null?t.left:0};t();this._viewportDetectionInterval=setInterval(t,this.options.viewportDetectionInterval)},_startAnimationLoop:function(){var n=this,i=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(n){t.setTimeout(n,1e3/60)}}();this._animationLoop=function(){i(n._animationLoop);n._repositionElements()};this._animationLoop()}};n.fn[u]=function(t){var i=arguments;return t===r||typeof t=="object"?this.each(function(){n.data(this,"plugin_"+u)||n.data(this,"plugin_"+u,new o(this,t))}):typeof t=="string"&&t[0]!=="_"&&t!=="init"?this.each(function(){var r=n.data(this,"plugin_"+u);r instanceof o&&typeof r[t]=="function"&&r[t].apply(r,Array.prototype.slice.call(i,1));t==="destroy"&&n.data(this,"plugin_"+u,null)}):void 0};n[u]=function(){var i=n(t);return i.stellar.apply(i,Array.prototype.slice.call(arguments,0))};n[u].scrollProperty=e;n[u].positionProperty=h;t.Stellar=o})(jQuery,window,document);